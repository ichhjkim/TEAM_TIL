# 5장. 형식맞추기 

클린코드(로버트 C.마틴) 책 내용 정리본임. 
실제 내용은 책을 보고, 책에 있는 소스코드와 함께 보면 좀 더 이해가 잘 될것.

`프로그래머라면 형식을 깔끔하게 맞춰 코드를 짜야한다.`
`팀으로 일한다면, 팀이 합의해 규칙을 정하고 모두가 그 규칙을 따라야한다.`


## 형식을 맞추는 목적

- 코드 형식은 의사소통의 일환이다. 
- 코드 기능은 이번 버전과 다음 버전이 다를 확률이 높지만, 코드의 가독성은 기능이 바뀌어도 코드의 품질에 영향을 미친다. 


## 파일의 적절한 행 길이를 유지하라 

7개의 유명한 오픈소스 프로젝트를 분석해본 결과를 그래프로 제시한다.

- 500줄을 넘지 않고 200줄 정도인 파일들로 구성하여도 커다란 시스템을 구현할 수 있다. 
- 물론 극단적으로 필요한 경우에 파일의 길이가 더 길어질 수는 있지만, 평균적으로 100~500줄인 경우의 비율이 매우 높다. 
- 작은 파일이 더 이해하기 쉽다. 


### 신문기사처럼 작성하라. 

- 소스 파일 이름은 설명이 가능하도록 신경써서 짓는다.
- 소스 파일 첫 부분은 고차원 개념과 알고리즘을 설명한다.
- 파일의 위에서 아래로 내려가면서 파일의 의도를 세세하게 묘사한다. 점점 처자원 함수와 세부 내역을 작성한다.


### 개념은 빈 행으로 분리하라. 

- 일련의 행 묶음은 완결된 생각 하나를 표현하므로, 서로 다른 생각은 빈 행으로 분리해야한다.
- 패키지 선언부, import, 함수 사이에 빈 행을 두자. 

```java
package fitnesse.wikitext.widgets;

import java.util.regex.*;

public class BoldWidget extends ParentWidget{

}

public String render() throws Exception {

}
```


### 세로밀집도, 수직거리

- 서로 밀접한 코드는 세로로도 가까이 배치되어야한다. 
- 세로 거리는 연관성을 표현한다. (한 개념을 이해하는데 다른 개념이 중요한 정도) 
- 연관성이 깊은 개념이 멀리 떨어져있으면 소스를 여러 곳을 뒤져야한다. 
    - 일반 변수선언 : 변수는 사용하는 위치에 최대한 가까이 선언. 
        1. 지역변수 : 각 함수 맨 처음에
        2. 루프 제어변수 : 루프 문 내부에
        3. 긴 함수 : 블록 상단이나 루프 직전에 변수 선언
    - 인스턴스 변수 선언 : 클래스 맨 처음 혹은 맨 끝. 잘 알려진 위치에 인스턴스 변수가 모여 있어야 한다.
    - 종속 함수 : 한 함수가 다른 함수를 호출하면 세로로 가까이 배치한다. 
    - 개념적 유사성 : 종속함수, 비슷한 동작을 수행하는 함수들(ex. assert 함수를 다양한 인수로 받는 경우 등)

### 세로 순서 

- 호출되는 함수를 호출하는 함수보다 나중에 배치한다.(고->저)
- 가장 중요한 개념을 가장 먼저 배치한다.
- 이러면 세부 내역을 일일이 확인하지 않아도 파일의 앞부분만 보고도 어느정도 코드 내용을 파악할 수 있다. 



## 가로 형식 맞추기

마찬가지로 7개의 유명한 오픈소스 프로젝트를 분석해본 결과를 그래프로 제시한다.

- 20~60자인 경우가 전체 소스코드에서 각 1% 정도이다. (전체의 약 40% 정도)
- 10자 미만은 30%
- 80자 이상은 급격히 감소 

- 가능하면 120자 미만으로 작성하도록 하자.


### 가로 공백과 밀집도

- 가로로는 공백을 이용해 밀접도, 느슨한 개념을 표현한다. 

`int lineSize = line.length();`
- 할당연산자 강조를 위해 연산자 주위에 공백을 주었다. 

```java
private void measureLine(String line, String line2){

}
```
- 함수와 이어지는 괄호 사이에는 공백을 넣지 않았다. 밀접한 관계이기 때문. 
- 괄호 안 인수는 공백으로 분리한다. 서로 다른 값이기 때문.
- 연산자 우선순위를 위해서도 공백을 줄 수 있다. (우선순위가 승수와 곱셉은 공백을 주지 않고, 우선순위가 낮은 +,-는 공백을 주는 방식이다.)


### 가로정렬

- 굳이 가로로 형식을 맞추지 말자. 오히려 필요한 부분의 내용이 안보일 수 있다. 
- 정렬이 필요할 정도로 데이터가 많다면, 클래스 분리를 고려해라.

```java
public class Sample{
    private Socket         socket;
    private InputStream    input;
    private OutputStream   output;
}
```

### 들여쓰기

- 범위로 이루어진 계층을 표현하기 위해서 들여쓰기를 사용한다. 
- 되도록 들여쓰기를 무시한 코드는 피하자. 
    ```java
    public String render() throws Exception {return "";}
    ```
- 빈 while, for 문은 세미콜론을 별도 줄로 분리해서 표현해주자. 잘 보이지 않는다. 
    ```java
    while (dis.read(buf, 0, readBufferSize) != -1)
    ;
    ```

## 팀 규칙

- 프로그래머라면 각자 선호하는 규칙이 있겠지만, 팀에 속한다면 팀 규칙을 따라라. 
- 좋은 소프트웨어 시스템은 읽기 쉬운 문서로 이루어진다. 
- 스타일은 일관적이고 매끄러워야한다. 
- 한 소스파일에서 사용된 방식은 다른 소스파일에서도 사용되어야 한다. 
- 여러 스타일을 섞는 것을 피해라.


